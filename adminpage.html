<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ExpensoMan - Expense Management</title>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background-color: rgb(13, 18, 26);
    color: #eee;
    margin: 0;
    padding: 16px;
    min-height: 100vh;
  }
  #root {
    max-width: 960px;
    margin: auto;
  }
  h1 {
    margin: 0 0 8px;
    color: #66b2ff;
    font-weight: 700;
    text-align: center;
  }
  h2, h3 {
    margin: 0 0 12px;
    color: #80d8ff;
    border-bottom: 1px solid #222;
    padding-bottom: 8px;
  }
  .user-switcher {
    text-align: center;
    margin-bottom: 24px;
  }
  .user-switcher button {
    background: #222;
    border: 1px solid #555;
    color: #eee;
    margin: 0 8px;
    padding: 8px 16px;
    cursor: pointer;
    border-radius: 6px;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  .user-switcher button.active,
  .user-switcher button:hover {
    background: #007bff;
    border-color: #007bff;
    color: #fff;
  }
  .dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(320px,1fr));
    gap: 24px;
  }
  .card {
    background-color: #222;
    padding: 16px 20px;
    border-radius: 12px;
    box-shadow: 0 0 8px #0008;
  }
  ul {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  li {
    background: #333;
    margin-bottom: 12px;
    padding: 12px 16px;
    border-radius: 8px;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
  }
  .expense-desc {
    flex: 1 1 60%;
    font-weight: 600;
    word-break: break-word;
  }
  .expense-details {
    flex: 1 1 40%;
    text-align: right;
  }
  .expense-status {
    font-weight: 700;
    padding: 4px 12px;
    border-radius: 9999px;
    text-transform: uppercase;
    user-select: none;
    cursor: default;
  }
  .status-PENDING {
    background-color: #d6a600;
    color: #222;
  }
  .status-APPROVED {
    background-color: #28a745;
    color: white;
  }
  .status-REJECTED {
    background-color: #dc3545;
    color: white;
  }
  button.approve-btn, button.reject-btn {
    margin-left: 12px;
    padding: 6px 16px;
    font-weight: 600;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
  }
  button.approve-btn {
    background-color: #28a745;
    color: white;
  }
  button.approve-btn:hover {
    background-color: #218838;
  }
  button.reject-btn {
    background-color: #dc3545;
    color: white;
  }
  button.reject-btn:hover {
    background-color: #a71d2a;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  input, select {
    padding: 10px 14px;
    font-size: 1em;
    border-radius: 6px;
    border: 1px solid #555;
    background-color: #222;
    color: #eee;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }
  
  /* --- MODIFICATION START --- */

  /* Better focus state for all inputs */
  input:focus, select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
  }

  /* Improved Dropdown Styling */
  select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23cccccc%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22/%3E%3C/svg%3E');
    background-repeat: no-repeat;
    background-position: right 14px top 50%;
    background-size: 12px;
    padding-right: 40px;
    cursor: pointer;
  }

  /* Improved Submit Button Styling */
  button.submit-btn {
    background: linear-gradient(45deg, #007bff, #0056b3);
    color: white;
    font-size: 1.1em;
    font-weight: 700;
    cursor: pointer;
    border: none;
    padding-top: 12px;
    padding-bottom: 12px;
    transition: all 0.2s ease-in-out;
  }
  button.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
  }

  /* --- MODIFICATION END --- */

  .message {
    margin-top: 16px;
    text-align: center;
    padding: 12px 16px;
    border-radius: 8px;
    font-weight: 700;
    user-select: none;
  }
  .message.success {
    background-color: #206a49;
    color: #b6eebb;
  }
  .message.error {
    background-color: #7a2424;
    color: #f9b8b8;
  }
  label {
    font-weight: 600;
    margin-bottom: -10px; /* Adjusted for better spacing */
  }
  .comment-input {
    resize: vertical;
    min-height: 40px;
  }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">

const {useState, useEffect} = React;

// --- MODIFICATION: Added 'email' to user data ---
const USERS = [
  {id: 1, name: "Admin User", role: "ADMIN", managerId: null, email: "admin@example.com"},
  {id: 2, name: "Manager User", role: "MANAGER", managerId: null, email: "manager@example.com"},
  {id: 3, name: "Employee User", role: "EMPLOYEE", managerId: 2, email: "employee@example.com"},
];

// Approval sequence example
const APPROVAL_SEQUENCE = [
  {role: "MANAGER", label: "Manager Approval", isManagerApprover: true},
  {role: "FINANCE", label: "Finance Approval"},
  {role: "DIRECTOR", label: "Director Approval"}
];

// Helper component to render approval steps status
const ApprovalStep = ({step, isCurrent, isDone}) => {
  let bg = "#666";
  if (isDone) bg = "#28a745";
  else if (isCurrent) bg = "#007bff";
  return <span style={{background: bg, color: "white", padding: "4px 12px", borderRadius: "9999px", marginRight: 8, userSelect:"none"}}>{step.label}</span>;
};

function App() {
  const [currentUser, setCurrentUser] = useState(USERS[2]); // default to Employee
  const [users, setUsers] = useState(USERS);
  const [expenses, setExpenses] = useState([]);
  const [expenseForm, setExpenseForm] = useState({
    amount: "", currency: "INR", category: "", description: "", date: ""
  });
  const [message, setMessage] = useState(null);

  // Helper to get user by id
  const getUserById = (id) => users.find(u => u.id === id);

  // Filtering expenses by logged in user
  const myExpenses = expenses.filter(e => e.employeeId === currentUser.id);
  
  // --- NEW: Calculate direct reports for the current manager ---
  let directReports = [];
  if (currentUser.role === "MANAGER") {
    directReports = users.filter(user => user.managerId === currentUser.id);
  }

  // Filtering pending expenses awaiting approval for manager or admin 
  let approvalQueue = [];
  if(currentUser.role === "MANAGER" || currentUser.role ==="ADMIN") {
    approvalQueue = expenses.filter(exp => {
      if(exp.status !== "PENDING") return false;
      const step = APPROVAL_SEQUENCE[exp.currentApprovalStep];
      if(!step) return false;
      if(currentUser.role === "MANAGER") {
        return step.isManagerApprover === true && getUserById(exp.employeeId)?.managerId === currentUser.id;
      }
      if(currentUser.role === "ADMIN") {
        return !step.isManagerApprover;
      }
      return false;
    });
  }

  function handleChange(e) {
    const {name, value} = e.target;
    setExpenseForm(form => ({...form, [name]: value}));
  }

  function submitExpense(e) {
    e.preventDefault();
    if(!expenseForm.amount || !expenseForm.description || !expenseForm.category || !expenseForm.date) {
      setMessage({type:"error", text:"Please fill all fields."});
      return;
    }
    const newExpense = {
      id: expenses.length + 1,
      employeeId: currentUser.id,
      amount: parseFloat(expenseForm.amount),
      currency: expenseForm.currency,
      category: expenseForm.category,
      description: expenseForm.description,
      date: expenseForm.date,
      status: "PENDING",
      currentApprovalStep: 0, 
      comments: []
    };
    setExpenses(exps => [...exps, newExpense]);
    setExpenseForm({amount:"",currency:"INR",category:"",description:"",date:""});
    setMessage({type:"success", text:"Expense submitted."});
  }

  function handleApproval(expenseId, approved, comment="") {
    setExpenses(exps => exps.map(exp => {
      if(exp.id !== expenseId) return exp;
      const newComments = [...exp.comments, {by: currentUser.name, text: comment, date: new Date().toISOString(), approved}];
      if(!approved) {
        return {...exp, status: "REJECTED", comments: newComments};
      }
      const nextStep = exp.currentApprovalStep + 1;
      if(nextStep >= APPROVAL_SEQUENCE.length) {
        return {...exp, status: "APPROVED", currentApprovalStep: nextStep, comments: newComments};
      }
      return {...exp, currentApprovalStep: nextStep, comments: newComments};
    }));
    setMessage({type:"success", text: approved ? "Expense approved." : "Expense rejected."});
  }

  const Comments = ({comments}) => (
    <div style={{fontSize:"0.9em", marginTop:"6px", color:"#ccc"}}>
      <strong>Comments:</strong>
      {comments.length === 0 && <div style={{display: 'inline', marginLeft: '4px'}}>None yet.</div>}
      <ul>
        {comments.map((c,i) => (
          <li key={i} style={{padding: '8px', background: '#444', fontSize:'0.9em'}}>
            <div><b>{c.by}</b> &middot; <span style={{color: c.approved ? '#90ee90' : '#ff7f7f'}}>{c.approved ? "Approved" : "Rejected"}</span></div>
            <div>{c.text}</div>
            <div style={{fontSize:'0.8em', color:'#aaa', width: '100%', textAlign:'right'}}>{new Date(c.date).toLocaleString()}</div>
          </li>
        ))}
      </ul>
    </div>
  );

  const [newUserData, setNewUserData] = useState({name:"", role:"EMPLOYEE", managerId:""});
  function handleUserChange(e) {
    const {name, value} = e.target;
    setNewUserData(data => ({...data, [name]: value}));
  }
  function addUser() {
    if(!newUserData.name) {
      setMessage({type:"error", text:"User name required"});
      return;
    }
    const newId = users.length + 1;
    const managerIdNum = newUserData.managerId ? parseInt(newUserData.managerId) : null;
    setUsers(u => [...u, {id:newId, name:newUserData.name, role:newUserData.role, managerId: managerIdNum}]);
    setNewUserData({name:"", role:"EMPLOYEE", managerId:""});
    setMessage({type:"success", text:"User added"});
  }

  return (
    <div>
      <div className="header" style={{textAlign:"center", marginBottom:"24px"}}>
        <h1>ExpensoMan</h1>
        <p>A Simple Expense Management Dashboard</p>
      </div>

      <div className="user-switcher">
        <span>Login as: </span>
        {USERS.map(user => (
          <button 
            key={user.id} 
            className={currentUser.id===user.id ? "active" : ""}
            onClick={() => {setCurrentUser(user); setMessage(null);}}>
            {user.name} ({user.role})
          </button>
        ))}
      </div>

      {message && <div className={`message ${message.type}`}>{message.text}</div>}

      <div className="dashboard">

        {/* --- NEW: Manager Info Card --- */}
        {currentUser.role === "MANAGER" && (
            <div className="card">
                <h2>Manager Dashboard</h2>
                <p style={{margin: '8px 0'}}><strong>Name:</strong> {currentUser.name}</p>
                <p style={{margin: '8px 0'}}><strong>Email:</strong> {currentUser.email}</p>
                
                <h3 style={{marginTop: '20px'}}>My Direct Reports:</h3>
                {directReports.length > 0 ? (
                    <ul>
                        {directReports.map(employee => (
                            <li key={employee.id} style={{background: '#444', justifyContent: 'flex-start', gap: '10px'}}>
                                <strong>{employee.name}</strong> 
                                <span>({employee.role})</span>
                            </li>
                        ))}
                    </ul>
                ) : (
                    <p>You have no direct reports assigned.</p>
                )}
            </div>
        )}

        {/* Approval queue */}
        {(currentUser.role === "MANAGER" || currentUser.role === "ADMIN") && (
          <div className="card">
            <h2>{currentUser.role==="MANAGER" ? "Team Expenses to Approve" : "Expense Approval Queue"}</h2>
            {approvalQueue.length === 0 && <div>No expenses awaiting your approval.</div>}
            <ul>
              {approvalQueue.map(exp => (
                <li key={exp.id}>
                  <div className="expense-desc">
                    <strong>{getUserById(exp.employeeId)?.name || "Unknown"}</strong>: {exp.description} ({exp.category})
                    <br />
                    Date: {exp.date} &middot; Amount: {exp.amount} {exp.currency}
                    <br />
                    <div style={{marginTop: '8px'}}>
                      {APPROVAL_SEQUENCE.map((step,i) => (
                        <ApprovalStep 
                          key={i} 
                          step={step} 
                          isCurrent={i === exp.currentApprovalStep} 
                          isDone={i < exp.currentApprovalStep}
                        />
                      ))}
                    </div>
                    <Comments comments={exp.comments} />
                  </div>
                  <div className="expense-details">
                    <textarea 
                      className="comment-input"
                      placeholder="Add comment (optional)" 
                      rows="2"
                      onChange={(e) => exp.tempComment = e.target.value}
                      style={{width:"100%", marginBottom:"8px",
                        padding: "8px", borderRadius: "6px", border: "1px solid #555",
                        backgroundColor: "#222", color:"#eee"}}
                    />
                    <button 
                      className="approve-btn" 
                      onClick={() => handleApproval(exp.id, true, exp.tempComment)}
                    >
                      Approve
                    </button>
                    <button 
                      className="reject-btn" 
                      onClick={() => handleApproval(exp.id, false, exp.tempComment)}
                    >
                      Reject
                    </button>
                  </div>
                </li>
              ))}
            </ul>
          </div>
        )}

        {/* My Expenses and Submission */}
        <div className="card">
          <h2>My Submitted Expenses</h2>
          {myExpenses.length === 0 ? (
            <p>You have not submitted any expenses yet.</p>
          ) : (
            <ul>
              {myExpenses.map(exp => (
                <li key={exp.id}>
                  <div className="expense-desc">
                    {exp.description} ({exp.category})
                    <br />
                    Date: {exp.date}
                  </div>
                  <div className="expense-details">
                    {exp.amount.toFixed(2)} {exp.currency}
                    <span className={`expense-status status-${exp.status}`}>
                      {exp.status}
                    </span>
                  </div>
                </li>
              ))}
            </ul>
          )}

          {currentUser.role === "EMPLOYEE" && (
            <>
              <h2 style={{marginTop:"32px"}}>Submit New Expense</h2>
              <form onSubmit={submitExpense}>
                <label>Amount *</label>
                <input type="number" name="amount" onChange={handleChange} value={expenseForm.amount} min="0" step="0.01" required />

                <label>Currency *</label>
                <select name="currency" onChange={handleChange} value={expenseForm.currency} required>
                  <option value="INR">INR (₹)</option>
                  <option value="USD">USD ($)</option>
                  <option value="EUR">EUR (€)</option>
                </select>

                <label>Category *</label>
                <input type="text" name="category" onChange={handleChange} value={expenseForm.category} placeholder="e.g. Travel, Food, Supplies" required />

                <label>Description *</label>
                <input type="text" name="description" onChange={handleChange} value={expenseForm.description} placeholder="Brief description" required />

                <label>Date *</label>
                <input type="date" name="date" onChange={handleChange} value={expenseForm.date} required />

                <button type="submit" className="submit-btn">Submit Expense</button>
              </form>
            </>
          )}
        </div>

        {/* Admin panel for user management */}
        {currentUser.role === "ADMIN" && (
          <div className="card" style={{gridColumn: '1 / -1'}}>
            <h2>Admin Panel — Manage Users</h2>
            <form onSubmit={e => { e.preventDefault(); addUser(); }}>
              <label>Name *</label>
              <input name="name" value={newUserData?.name || ''} onChange={handleUserChange} placeholder="Full Name" required />
              <label>Role *</label>
              <select name="role" value={newUserData?.role || "EMPLOYEE"} onChange={handleUserChange} required>
                <option value="EMPLOYEE">Employee</option>
                <option value="MANAGER">Manager</option>
                <option value="ADMIN">Admin</option>
              </select>
              <label>Manager (for Employee)</label>
              <select name="managerId" value={newUserData?.managerId || ""} onChange={handleUserChange}>
                <option value="">None</option>
                {users.filter(u => u.role === "MANAGER").map(m => (
                  <option key={m.id} value={m.id}>{m.name}</option>
                ))}
              </select>
              <button type="submit" className="submit-btn">Add User</button>
            </form>

            <h3 style={{marginTop:"24px"}}>All Users</h3>
            <ul>
              {users.map(u => (
                <li key={u.id}>
                  {u.name} ({u.role}) 
                  {u.role === "EMPLOYEE" && u.managerId && ` - Manager: ${getUserById(u.managerId)?.name || "Unknown"}`}
                </li>
              ))}
            </ul>
          </div>
        )}
      </div>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html> 